<!-- 대시보드 페이지 -->
<!DOCTYPE html>
<html>
<head>
  <title>대시보드</title>
</head>
<body>
  <h1>대시보드</h1>
  <h2>안녕하세요, <span id="name"></span>님</h2>
  <script src="http://code.jquery.com/jquery-latest.js"></script>
  <!-- 이미지 등록 폼 -->
  <form id="imageUploadForm" enctype="multipart/form-data">
    <input type="file" name="imageInput" accept="image/*" required>
    
    <button onclick="uploadImages()">이미지 등록</button>
  </form>

  <script>
    // 로그인한 사용자의 이름 표시
                $.ajax({
            url: '/getUsername',
            method: 'GET',
            dataType:"json",
            success: function(response) {
                // user 데이터를 받아와서 처리
                $('#name').text(response.username);
            },
            error: function(err) {
                console.error(err);
                // 오류 처리
            }
            });
            //이미지 등록 버튼 비활성화 정도 
            function checkFace(){
            //서버측에다가 api 요청 /checkFace 으로 요청받아서 
            //
            }
            $.ajax({
              url: '/checkImageStatus',
              type: 'GET',
              success: function(response) {
                if (response.isImageUploaded) {
                  disableImageUploadButton(); // 이미지 등록 버튼 비활성화
                }
              },
              error: function() {
                console.error('이미지 등록 상태 확인 실패');
              }
            });

            function uploadImages(){
              const fileInput = $('#imageInput')[0];
              const image = fileInput.files[0];

              const formData = new FormData();
              formData.append('image', image);
              
              $.ajax({
                        url: '/upload',
                        type: 'POST',
                        data: formData,
                        contentType: false,
                        processData: false,
                        success: function(response) {
                          console.log('이미지 전송 및 저장 완료');
                          //이미지 전송 및 저장완료일 경우 서버측에서 path를 디비에 저장함.
                          //로그인할 때 서버측에서 req.session.username 을 mysql로 검색해서 
                          // db에서 ok일 경우 버튼활성화 아닐경우 버튼 비활성화
                        },
                        error: function() {
                          console.error('이미지 전송 실패');
                        }
                });

            }
        



    
    
  </script>
</body>
</html>
